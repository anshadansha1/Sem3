SQL> create table customer(cust_id varchar2(5) primary key,cust_name varchar2(25),cust_location varchar2(30),cust_gender varchar2(1),constraint cid_chk check(cust_id like('C%')),constraint gnd_chk check(cust_gender in('M','F')));

Table created.

SQL> desc customer;
 Name                                      Null?    Type
 ----------------------------------------- -------- ----------------------------
 CUST_ID                                   NOT NULL VARCHAR2(5)
 CUST_NAME                                          VARCHAR2(25)
 CUST_LOCATION                                      VARCHAR2(30)
 CUST_GENDER                                        VARCHAR2(1)

SQL> select constraint_type,constraint_name from user_constraints where table_name='CUSTOMER'
  2  ;

C CONSTRAINT_NAME
- ------------------------------
C CID_CHK
C GND_CHK
P SYS_C0013124

SQL> select constraint_type,constraint_name from user_constraints where table_name='CUSTOMER';

C CONSTRAINT_NAME
- ------------------------------
C CID_CHK
C GND_CHK
P SYS_C0013124

SQL> select constraint_name,constraint_type from user_constraints where table_name='CUSTOMER';

CONSTRAINT_NAME                C
------------------------------ -
CID_CHK                        C
GND_CHK                        C
SYS_C0013124                   P

SQL> create table branch(br_id varchar2(5) primary key,br_location varchar2(30),constraint bid_chk check(br_id like('B%')));

Table created.

SQL> desc branch;
 Name                                      Null?    Type
 ----------------------------------------- -------- ----------------------------
 BR_ID                                     NOT NULL VARCHAR2(5)
 BR_LOCATION                                        VARCHAR2(30)

SQL> select constraint_name,constraint_type from user_constraints where table_name='BRANCH';

CONSTRAINT_NAME                C
------------------------------ -
BID_CHK                        C
SYS_C0013147                   P

SQL> create table account(acc_no varchar2(5) primary key,acc_type varchar2(2),acc_balance int,cust_id varchar2(5),br_id varchar2(5),constraint acno_chk check(acc_no like('A%')),constraint acty_chk check(acc_type in ('SB','CU')),constraint acbal_chk check(acc_balance > 1000),foreign key(cust_id) references customer(cust_id),foreign key(br_id) references branch(br_id));

Table created.

SQL> desc account;
 Name                                      Null?    Type
 ----------------------------------------- -------- ----------------------------
 ACC_NO                                    NOT NULL VARCHAR2(5)
 ACC_TYPE                                           VARCHAR2(2)
 ACC_BALANCE                                        NUMBER(38)
 CUST_ID                                            VARCHAR2(5)
 BR_ID                                              VARCHAR2(5)

SQL> select constraint_name,constraint_type from user_constraints where table_name='ACCOUNT';

CONSTRAINT_NAME                C
------------------------------ -
ACNO_CHK                       C
ACTY_CHK                       C
ACBAL_CHK                      C
SYS_C0013151                   P
SYS_C0013152                   R
SYS_C0013153                   R

6 rows selected.

SQL>

SQL> desc customer;
 Name                                      Null?    Type
 ----------------------------------------- -------- ----------------------------
 CUST_ID                                   NOT NULL VARCHAR2(5)
 CUST_NAME                                          VARCHAR2(25)
 CUST_LOCATION                                      VARCHAR2(30)
 CUST_GENDER                                        VARCHAR2(1)

SQL> insert into customer values('C100','Veena Rajiv','Mumbai','F');

1 row created.

SQL> insert into customer values('C101','Satheesh S','Kerala','M');

1 row created.

SQL> insert into customer values('C102','Ram K R','Tamilnadu','M');

1 row created.

SQL> insert into customer values('C103','Anand V','Kerala','M');

1 row created.

SQL> select * from customer;

CUST_ CUST_NAME                 CUST_LOCATION                  C
----- ------------------------- ------------------------------ -
C100  Veena Rajiv               Mumbai                         F
C101  Satheesh S                Kerala                         M
C102  Ram K R                   Tamilnadu                      M
C103  Anand V                   Kerala                         M

SQL> desc branch;
 Name                                      Null?    Type
 ----------------------------------------- -------- ----------------------------
 BR_ID                                     NOT NULL VARCHAR2(5)
 BR_LOCATION                                        VARCHAR2(30)

SQL> insert into customer values('B1','Mumbai');
insert into customer values('B1','Mumbai')
            *
ERROR at line 1:
ORA-00947: not enough values


SQL> insert into branch values('B1','Mumbai');

1 row created.

SQL> insert into branch values('B2','Kolkatta');

1 row created.

SQL> insert into branch values('B3','Kochi');

1 row created.

SQL> select * from branch;

BR_ID BR_LOCATION
----- ------------------------------
B1    Mumbai
B2    Kolkatta
B3    Kochi

SQL> insert into account values('A5000','SB',20000,'C100','B1');

1 row created.

SQL> insert into account values('A5001','SB',1500,'C101','B3');

1 row created.

SQL> insert into account values('A5002','CU',63000,'C100','B1');

1 row created.

SQL> insert into account values('A5003','SB',25000,'C102','B1');

1 row created.

SQL> select * from account;

ACC_N AC ACC_BALANCE CUST_ BR_ID
----- -- ----------- ----- -----
A5000 SB       20000 C100  B1
A5001 SB        1500 C101  B3
A5002 CU       63000 C100  B1
A5003 SB       25000 C102  B1

SQL>
1.

SQL> select cust_name from customer where cust_gender='M' and cust_location='Kerala';

CUST_NAME
-------------------------
Satheesh S
Anand V


2.
SQL> select cust_name from customer c join account a on c.cust_id=a.cust_id where a.acc_type='CU';

CUST_NAME
-------------------------
Veena Rajiv

[[[
SQL> select cust_name from  customer where cust_id in (select cust_id from account where acc_type='SB');

CUST_NAME
-------------------------
Veena Rajiv
Satheesh S
Ram K R

]]]

3.

SQL> select cust_name from customer c join account a on c.cust_id=a.cust_id join branch b on a.br_id=b.br_id where b.br_location like('K%');

CUST_NAME
-------------------------
Satheesh S

SQL>

4.
SQL> select br_location,count(*) from branch b join account a on b.br_id=a.br_id group by br_location;

BR_LOCATION                      COUNT(*)
------------------------------ ----------
Mumbai                                  3
Kochi                                   1

SQL> select br_location,count(*) from branch b join account a on b.br_id=a.br_id group by br_location having count(*)>2;

BR_LOCATION                      COUNT(*)
------------------------------ ----------
Mumbai                                  3

SQL> select br_location from branch b join account a on b.br_id=a.br_id group by br_location having count(*)>2;

BR_LOCATION
------------------------------
Mumbai

SQL>


5.

SQL> select cust_name from customer c join account a on c.cust_id=a.cust_id where acc_type='SB' and a.acc_balance > 
(select avg(acc_balance) from account);

no rows selected

SQL>
####################################################################################################################################

SQL> create table backupaccount(acc_no varchar2(5),acc_balance int,entry_date date,operation_type varchar2(10));

Table created.

SQL> desc backupaccount;
 Name                                                  Null?    Type
 ----------------------------------------------------- -------- ------------------------------------
 ACC_NO                                                         VARCHAR2(5)
 ACC_BALANCE                                                    NUMBER(38)
 ENTRY_DATE                                                     DATE
 OPERATION_TYPE                                                 VARCHAR2(10)

SQL> edit E:\plsql\set1_trigger.sql

[[[
CREATE OR REPLACE TRIGGER acc_trig
BEFORE delete or update 
ON account

for each row

BEGIN

	IF :old.acc_balance <= 50 
	THEN
	RAISE_APPLICATION_ERROR(-20500,'LOW BALANCE!');
	END IF;

	
	IF deleting 
	THEN
	insert into backupaccount values(:old.acc_no,:old.acc_balance,sysdate,'DELETE');
	
	ELSIF updating
	THEN
	insert into backupaccount values(:old.acc_no,:old.acc_balance,sysdate,'UPDATE');
	
	END IF;
END;
]]]


SQL> update account set acc_balance=50 where acc_no='A5000';
update account set acc_balance=50 where acc_no='A5000'
*
ERROR at line 1:
ORA-02290: check constraint (SYSTEM.ACBAL_CHK) violated


SQL> delete from account where acc_no='A5003';

1 row deleted.

SQL> select * from account;

ACC_N AC ACC_BALANCE CUST_ BR_ID
----- -- ----------- ----- -----
A5000 SB       20000 C100  B1
A5001 SB        1500 C101  B3
A5002 CU       63000 C100  B1

SQL> select * from backupaccount;

ACC_N ACC_BALANCE ENTRY_DAT OPERATION_
----- ----------- --------- ----------
A5003       25000 22-NOV-23 DELETE

SQL>

